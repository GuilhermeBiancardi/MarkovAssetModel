# MarkovAssetModel

```php

require 'MarkovAssetModel.php';

$prices = [
    13.82, 13.67, 13.96, 14.54, 14.62, 14.38, 14.52, 13.80, 13.77, 13.34, 
    13.20, 12.98, 12.69, 12.56, 12.38, 12.05, 12.34, 12.69, 12.44, 12.60, 
    12.52, 12.62, 12.57, 12.48, 12.45, 12.60, 12.43, 12.47, 12.40, 12.26, 
    12.22, 11.99, 10.60, 11.35, 11.31, 11.01, 10.47, 10.40, 10.80, 10.82, 
    11.21, 11.42, 10.90, 10.82, 11.16, 11.21, 11.25, 11.17, 11.20, 11.51, 
    11.41, 11.51, 11.55, 11.13, 10.93, 11.08, 11.12, 11.17, 11.52, 11.42, 
    11.23, 11.22, 11.08, 11.01, 10.92, 10.95, 11.08, 11.08, 11.10, 11.11, 
    11.16, 11.11, 11.29, 11.19, 11.28, 11.29, 11.16, 11.36, 11.11, 11.11, 
    11.16, 11.01, 10.97, 10.95, 11.23, 11.37, 11.46, 11.38, 11.68, 11.68, 
    11.89, 12.06, 12.26, 12.37, 12.40, 12.49, 12.32, 12.52, 12.69, 12.74, 
    12.72, 12.90, 13.37, 13.57, 13.87, 13.78, 13.52, 13.48, 13.44, 13.59, 
    13.54, 13.64, 13.32, 13.30, 13.19, 12.91, 12.91, 12.94, 12.55, 12.46, 
    12.37, 12.26, 12.13, 12.26, 12.19, 12.00, 12.16, 12.13, 12.44, 12.38, 
    12.47, 12.28, 12.13, 12.04, 12.25, 12.37, 12.19, 12.13, 12.31, 12.37, 
    12.55, 12.35, 12.07, 12.23, 12.16, 11.98, 11.77, 12.13, 12.02, 11.71, 
    11.60, 11.35, 11.26, 11.24, 11.19, 11.24, 11.32, 11.34, 11.44, 11.81, 
    11.77, 11.61, 11.78, 11.67, 11.75, 11.76, 11.27, 11.24, 11.44, 10.96, 
    11.15, 11.19, 11.44, 11.35, 11.26, 11.45, 11.24, 10.88, 11.15, 11.41, 
    11.44, 11.35, 11.60, 11.36, 11.43, 11.22, 11.48, 11.34, 11.88, 11.90, 
    11.78, 12.03, 11.93, 11.95, 11.89, 12.27, 12.51, 11.90, 12.09, 11.58, 
    11.23, 11.46, 11.34, 11.33, 11.23, 11.07, 11.32, 11.40, 11.13, 11.38, 
    11.45, 11.43, 11.96, 11.73, 11.71, 11.55, 11.38, 11.30, 11.28, 11.22, 
    11.69, 11.91, 12.53, 12.11, 12.13, 12.54, 12.33, 12.66, 12.68, 13.02, 
    12.84, 12.90, 12.61, 12.80, 12.69, 12.69, 12.48, 12.44, 12.01, 11.65, 
    11.68, 11.61, 11.57, 11.59, 11.53, 11.47, 11.42, 11.41, 11.42, 11.23, 
    11.32, 11.34, 11.39, 11.44, 11.55, 11.74, 12.04, 12.06, 12.17, 12.28, 
    12.35, 12.35, 12.41, 12.73, 12.61, 12.78, 12.86, 12.93, 12.91, 12.70, 
    12.78, 12.76, 12.61, 12.75, 12.64, 12.78, 13.22, 13.28, 13.91, 13.99, 
    13.99, 14.27, 13.97, 14.10, 14.17, 13.72, 13.94, 14.09, 14.09, 13.73, 
    13.15, 13.25, 14.00, 13.82, 13.54, 13.62, 13.47, 13.65, 13.78, 13.75, 
    14.03, 14.31, 14.24, 14.40, 14.39, 14.25, 14.31, 14.23, 14.15, 14.14, 
    14.01, 13.64, 13.71, 13.96, 14.21, 14.30, 14.27, 14.34, 14.35, 14.88, 
    14.35, 14.33, 14.04, 14.15, 13.83, 13.89, 13.87, 13.54, 13.45, 13.72, 
    14.12, 13.76, 13.80, 13.84, 13.68, 13.98, 14.33, 14.31, 14.44, 14.85, 
    14.64, 14.55, 15.08, 15.72, 15.68, 15.59, 15.54, 15.37, 14.97, 15.19, 
    15.22, 15.24, 15.02, 14.84, 14.73, 14.60, 14.58, 14.34, 14.01, 14.01, 
    14.23, 14.27, 14.38, 13.79, 13.74, 13.65, 13.57, 13.85, 13.90, 13.83, 
    13.95, 13.86, 13.81, 13.74, 13.65, 13.85, 13.98, 13.75, 13.80, 13.65, 
    13.63, 13.91, 14.11, 14.49, 14.49, 14.59, 14.49, 14.71, 14.77, 14.86, 
    15.14, 15.04, 14.92, 15.12, 15.22, 15.51, 15.80, 16.30, 16.57, 16.71, 
    17.45, 18.44, 17.97, 18.06, 17.90, 17.48, 16.37, 16.54, 16.87, 16.59, 
    16.99, 16.90, 17.25, 17.20, 16.94, 17.20, 17.28, 16.92, 16.10, 16.03, 
    16.48, 16.68, 16.45, 16.47, 16.30, 16.12, 16.44, 16.69, 16.57, 16.87, 
    16.66, 15.89, 15.77, 15.77, 15.68, 15.76, 16.96, 16.05, 16.31, 16.60, 
    16.63, 16.39, 16.00, 16.11, 16.02, 16.15, 16.98, 17.04, 17.84, 18.28, 
    16.44, 16.16, 15.59, 15.79, 15.88, 15.14, 15.50, 15.83, 16.06, 15.50, 
    15.57, 15.16, 14.86, 14.53, 14.89, 14.05, 13.75, 13.70, 14.03, 13.89, 
    14.06, 14.29, 13.96, 14.21, 14.38, 14.39, 14.38, 14.70, 14.36, 14.51, 
    14.47, 14.29, 14.27, 13.78, 13.13, 12.81, 13.17, 13.44, 13.58, 13.93, 
    14.06, 14.19, 14.54, 14.52, 14.04, 14.29, 14.31, 13.71, 13.45, 13.63, 
    14.25, 14.45, 14.31, 14.55, 14.75, 14.66, 14.69, 14.68, 15.54, 15.76, 
    16.12, 16.51, 16.39, 16.31, 16.75, 16.75, 16.56, 16.82, 16.77, 16.57, 
    16.26, 16.16, 16.25, 16.02, 16.40, 16.32, 16.64, 16.73, 17.12, 17.28, 
    17.47, 17.65, 17.21, 17.35, 17.01, 16.78, 16.93, 16.39, 15.73, 15.91, 
    16.27, 16.64, 16.81, 16.44, 16.13, 16.03, 15.91, 15.93, 16.10, 15.82, 
    15.73, 15.92, 15.96, 15.78, 15.94, 15.95, 16.06, 16.25, 16.55, 16.59, 
    16.39, 16.66, 16.60, 16.55, 16.56, 16.94, 18.12, 18.11, 18.42, 18.46, 
    18.50, 18.28, 18.45, 18.42, 18.25, 18.10, 18.12, 18.18, 17.75, 17.69, 
    17.89, 18.34, 43.30, 18.27, 18.22, 18.45, 18.83, 18.76, 18.85, 18.31, 
    18.34, 18.32, 18.68, 18.43, 18.87, 18.93, 18.94, 18.83, 18.80, 18.96, 
    18.92, 18.98, 19.37, 19.43, 19.66, 19.65, 20.61, 21.35, 21.13, 21.24, 
    21.67, 21.51, 21.91, 21.90, 22.60, 22.17, 22.17, 22.23, 21.82, 21.55, 
    21.75, 21.47, 21.90, 21.76, 21.62, 21.30, 21.71, 21.31, 21.01, 20.67, 
    20.87, 20.73, 20.91, 20.98, 20.61, 20.84, 21.09, 20.67, 20.57, 20.74, 
    20.31, 20.55, 20.94, 20.58, 20.67, 20.71, 20.60, 20.57, 20.42, 20.31, 
    20.41, 20.64, 20.43, 20.32, 20.50, 20.69, 20.77, 20.70, 21.20, 21.30, 
    21.02, 20.74, 21.34, 21.46, 21.15, 20.82, 20.96, 47.49, 20.89, 20.82, 
    20.68, 20.62, 20.94, 21.06, 21.04, 21.10, 21.17, 21.08, 21.05, 21.23, 
    20.75, 20.78, 20.66, 20.37, 20.55, 21.21, 21.00, 20.94, 20.68, 20.83, 
    20.90, 21.75, 21.63, 21.59, 21.80, 21.73, 22.17, 21.97, 21.87, 22.04, 
    21.96, 21.93, 21.83, 21.84, 22.29, 21.72, 21.57, 21.52, 21.55, 22.30, 
    22.46, 22.71, 23.00, 22.04, 22.36, 22.28, 22.39, 22.38, 22.55, 22.67, 
    22.83, 22.99, 23.07, 23.04, 23.46, 23.80, 23.84, 24.54, 24.59, 24.49, 
    24.49, 23.97, 24.36, 24.62, 24.61, 23.89, 24.10, 24.26, 24.85, 24.86, 
    24.96, 24.66, 24.70, 24.77, 25.00, 24.96, 25.20, 24.91, 24.94, 24.67, 
    24.97, 25.18, 24.80, 24.76, 24.93, 25.08, 25.57, 25.42, 25.47, 25.18, 
    25.44, 25.27, 25.72, 25.77, 25.74, 25.92, 25.71, 25.58, 25.68, 26.27, 
    26.26, 26.54, 27.12, 27.04, 26.63, 26.19, 26.55, 26.55, 26.33, 26.81, 
    26.98, 27.04, 26.81, 26.48, 26.73, 27.05, 27.11, 26.70, 26.73, 26.62, 
    26.80, 27.20, 26.94, 26.68, 26.41, 26.77, 26.47, 26.36, 26.63, 26.04, 
    25.95, 26.23, 25.86, 25.75, 25.86, 25.99, 26.01, 26.32, 26.06, 26.11, 
    26.21, 26.39, 26.50, 26.91, 27.14, 26.77, 26.84, 26.49, 26.24, 25.94, 
    26.00, 25.96, 25.76, 25.46, 25.66, 25.56, 25.45, 25.61, 25.61, 25.49, 
    25.76, 26.23, 26.38, 26.30, 26.38, 25.23, 25.67, 25.87, 26.04, 25.70, 
    25.73, 25.74, 25.95, 25.93, 25.56, 25.04, 25.17, 27.00, 25.48, 25.40, 
    25.40, 25.21, 25.24, 25.31, 25.37, 25.70, 25.27, 25.29, 25.57, 25.09, 
    25.26, 25.20, 25.20, 24.84, 25.02, 25.14, 25.35, 25.54, 25.61, 25.44, 
    25.43, 25.44, 25.11, 25.20, 25.44, 25.58, 25.46, 25.04, 24.96, 25.35, 
    25.22, 25.56, 25.67, 25.76, 26.01, 25.90, 25.82, 25.85, 25.70, 25.60, 
    25.61, 25.83, 25.87, 25.67, 25.29, 25.12, 24.92, 24.96, 25.39, 25.05, 
    24.95, 25.29, 25.83, 26.17, 26.61, 26.81, 27.02, 27.75, 27.87, 27.75, 
    27.12, 27.32, 27.43, 27.12, 27.28, 27.40, 27.22, 27.51, 27.76, 28.06, 
    28.32, 27.85, 28.20, 27.78, 27.79, 27.51, 27.69, 27.84, 27.66, 27.53, 
    27.20, 26.80, 26.70, 26.68, 26.60, 26.78, 26.55, 26.48, 26.39, 26.46, 
    26.21, 26.17, 26.30, 26.29, 25.75, 25.53, 25.66, 25.84, 25.79, 26.08, 
    26.04, 26.01, 25.94, 25.63, 25.66, 25.69, 25.69, 25.65, 25.50, 25.69, 
    25.66, 25.42, 25.57, 25.58, 25.63, 25.52, 25.32, 25.34, 25.29, 25.29, 
    24.72, 25.05, 25.19, 24.61, 24.94, 25.09, 25.49, 25.04, 24.31, 24.60, 
    24.40, 24.70, 24.99, 25.30, 24.56, 24.50, 24.66, 25.18, 24.85, 24.51, 
    24.16, 24.42, 23.74, 23.89, 24.08, 23.92, 24.20, 24.11, 24.17, 23.92, 
    23.74, 23.96, 24.25, 24.16, 24.27, 24.21, 24.21, 24.65, 25.27, 25.38, 
    25.35, 25.43, 25.66, 26.13, 26.72, 26.62, 27.71, 27.53, 27.44, 27.64, 
    27.68, 27.61, 27.77, 27.83, 28.15, 27.78, 27.82, 28.06, 27.60, 27.45, 
    28.75, 29.16, 29.45, 28.86, 28.00, 27.98, 27.81, 28.23, 28.07, 27.96, 
    27.31, 27.14, 27.10, 27.42, 27.34, 27.09, 27.05, 27.49, 27.88, 28.46, 
    28.50, 28.39, 28.25, 28.37, 28.36, 28.47, 28.81, 28.69, 28.64, 28.19, 
    28.33, 28.35, 28.51, 27.98, 27.68, 27.63, 27.75, 27.56, 27.80, 28.07, 
    27.77, 27.65, 27.43, 27.78, 28.04, 27.70, 28.01, 28.35, 28.50, 28.93, 
    28.90, 29.12, 28.90, 29.31, 29.41, 29.53, 29.07, 29.66, 29.76, 29.40, 
    25.67, 25.04, 25.50, 25.26, 25.05, 24.42, 24.67, 24.12, 23.64, 23.27, 
    22.99, 22.86, 22.98, 22.35, 22.24, 21.71, 21.73, 21.54, 21.40, 21.42, 
    21.59, 21.98, 21.90, 21.81, 21.35, 21.09, 21.44, 21.26, 21.60, 21.73, 
    22.09, 21.91, 21.99, 22.30, 22.43, 22.06, 22.00, 21.45, 21.21, 21.14, 
    20.68, 20.90, 20.88, 20.74, 20.26, 19.86, 19.89, 20.21, 20.07, 20.24, 
    19.94, 19.95, 19.90, 19.70, 18.35, 18.72, 18.62, 18.70, 18.91, 18.93, 
    19.10, 19.24, 19.28, 19.85, 20.65, 21.07, 19.80, 19.86, 19.69, 20.50, 
    20.05, 20.38, 20.63, 21.05, 21.39, 21.09, 20.42, 20.28, 20.42, 21.15, 
    20.95, 21.40, 22.05, 22.22, 22.31, 21.82, 21.94, 21.87, 22.10, 21.62, 
    21.51, 22.13, 22.11, 21.79, 22.11
];

// 2) Instancia o modelo (thresholds -1% / +1%, Laplace alpha=1)
$model = new MarkovAssetModel(-0.01, +0.01, 1.0);

// 3) Calibra a partir dos preços
$model->fitFromPrices($prices);

// 4) Consulta a matriz de transição
$P = $model->getTransitionMatrix();
echo "Matriz de transição, Probabilidade:\n<br>";
echo "<table border='1'><tr><th>Down</th><th>Flat</th><th>Up</th></tr>";
foreach ($P as $row) {
    echo "<tr><td style='padding: 5px;'>" . implode("</td><td style='padding: 5px;'>", array_map(fn($v) => number_format($v, 3, '.', '') * 100 . "%", $row)) . "</td></tr>";
}
echo "</table>";

// 5) Simula 50000 cenários para 30 dias úteis
$horizon = 30;
$nScen = 50000;
list($paths, $endStates) = $model->simulate($horizon, $nScen);

// 6) Faz o sumário
$startPrice = end($prices);
$summary = $model->summarize($paths, $startPrice);

$labels = [
    "start_price" => "Preço inicial",
    "median_price" => "Preço mediano",
    "prob_neg_return" => "Probabilidade de retorno negativo",
    "VaR5_price" => "VaR 5% (Preço)",
    "p95_price" => "Preço no percentil 95",
    "mean_return" => "Retorno médio",
    "std_return" => "Desvio-padrão do retorno"
];

echo "\nResumo:\n<br>";
foreach ($summary as $k => $v) {
    $label = $labels[$k] ?? $k;
    echo str_pad($label, 20) . ": " . (is_numeric($v) ? number_format($v, 6, '.', '') : $v) . PHP_EOL . "<br>";
}

```
